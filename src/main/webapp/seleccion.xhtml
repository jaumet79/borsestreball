<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">
	
	<br/>
	<h:outputText value="#{msg['inscripcion.titulo']} &nbsp;&nbsp;|&nbsp;&nbsp; #{seleccionBean.bolsa.descripcio} &nbsp;&nbsp;|&nbsp;&nbsp; #{seleccionBean.bolsa.categoria.descripcion}" style="font-size:20px;font-variant:small-caps;padding-left:50px;"/>
	<br/><br/>
	
	<!-- TOOLBAR -->
	<h:form id="frmSeleccion">
		<div >
			<p:toolbar>
            	<p:toolbarGroup>
              	  <p:commandButton value="#{msg['inscripcion.anyadir']}" icon="pi pi-plus" actionListener="#{seleccionBean.openNew}"
                                 update=":frmDialog:manage-product-content" oncomplete="PF('manageProductDialog').show()"
                                 styleClass="ui-button-success" style="margin-right: .5rem">
                    	<p:resetInput target=":frmDialog:manage-product-content"/>
	              </p:commandButton>
	            </p:toolbarGroup>
    	    </p:toolbar>
		</div>
	</h:form>
	
	<!-- TAULA CANDIDATS -->
	<h:form id="frmLista">
	
		<p:dataTable var="seleccion" value="#{seleccionBean.bolsa.listaSeleccion}" style="padding:15px;">
			
			<f:facet name="header">#{msg['inscripcion.inscripciones']}</f:facet>
			
			<p:column headerText="#{msg['inscripcion.documento']}">
				<h:outputText value="#{seleccion.persona.dni}" />
			</p:column>
			
			<p:column headerText="#{msg['inscripcion.nombre.completo']}">
				<h:outputText value="#{seleccion.persona.nomComplet}" />
			</p:column>
			
			<p:column headerText="#{msg['inscripcion.telefono']}">
				<h:outputText value="#{seleccion.persona.telefon}" />
			</p:column>
			
			<p:column headerText="#{msg['inscripcion.puntuacion.total']}">
				<h:outputText value="#{seleccion.puntuacionTotal}" />
			</p:column>
			
			<p:column headerText="#{msg['inscripcion.estado']}">
				<h:outputText value="#{seleccion.estat}" />
			</p:column>
			
			<p:column headerText="#{msg['inscripcion.motivo']}">
				<h:outputText value="#{seleccion.motiuExclusio}" />
			</p:column>
			
			<p:column>
				<p:commandButton action="#{seleccionBean.cargarMeritosBySeleccion}" value="#{msg['inscripcion.meritos']}" update=":frmMeritos" 
					oncomplete="PF('wvMerits').show()" rendered="#{seleccion.estat == 'ADMES'}">
					<f:setPropertyActionListener value="#{seleccion}" target="#{seleccionBean.seleccion}" />
				</p:commandButton>
			</p:column>
			
			<p:column>
				<p:commandButton value="#{msg['inscripcion.excluir']}" update=":frmExclusion" oncomplete="PF('wvExclusion').show()"
					rendered="#{seleccion.estat == 'ADMES'}">
					<f:setPropertyActionListener value="#{seleccion}" target="#{seleccionBean.seleccion}" />
				</p:commandButton>
				
				<p:commandButton value="#{msg['inscripcion.incluir']}" update=":frmLista" rendered="#{seleccion.estat == 'EXCLOS'}" action="#{seleccionBean.incluirSeleccion}">
					<p:confirm header="#{msg['inscripcion.incluir']}" message="#{msg['inscripcion.incluir.msg']}" icon="pi pi-info-circle" />
					<f:setPropertyActionListener value="#{seleccion}" target="#{seleccionBean.seleccion}" />
				</p:commandButton>
				
				<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
           			<p:commandButton value="#{msg['no']}" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
           			<p:commandButton value="#{msg['si']}" type="button" styleClass="ui-confirmdialog-yes" />
       			</p:confirmDialog>
			</p:column>
					
		</p:dataTable>
		
	</h:form>
		
		
		
	<!-- DIALOG CERCAR PERSONA -->
	<p:dialog header="#{msg['inscripcion.buscar.persona']}" showEffect="fade" modal="true" widgetVar="manageProductDialog" appendTo="@(body)">
		<h:form id="frmDialog">
                  
            <p:outputPanel id="manage-product-content" class="ui-fluid">
            
            	<p:panelGrid columns="3" >
						<p:outputLabel value="#{msg['inscripcion.documento']}"/>
						<p:inputText id="inpDocument" value="#{seleccionBean.dni}" 
							required="true" requiredMessage="#{msg['inscripcion.documento.obligatorio']}" />
						<p:message for="inpDocument"/>
						
						<p:outputLabel value="" />
						<p:commandButton action="#{seleccionBean.buscarPersonaPorDni}" value="#{msg['buscar']}" 
							update="manage-product-content :frmHeader:messages" />
						<p:outputLabel value="" />
				</p:panelGrid>
				
				<br/>
				
				<p:panelGrid rendered="#{seleccionBean.personaBusqueda != null}" columns="2">
					<h:outputText value="#{msg['inscripcion.nombre.completo']}" />
					<h:outputText value="#{seleccionBean.personaBusqueda.nomComplet}" />
					
					<h:outputText value="" />
					<p:commandButton action="#{seleccionBean.addPersonaToBolsa}" value="#{msg['inscripcion.anyadir.bolsa']}" 
							update=":frmSeleccion :frmLista" onclick="PF('manageProductDialog').hide()" />
						
				</p:panelGrid>
            
			</p:outputPanel>
		</h:form>
	</p:dialog>
		
		
	<!-- DIALOG MERITS -->
	<p:dialog header="#{msg['inscripcion.meritos']}" showEffect="fade" modal="true"
                 widgetVar="wvMerits" appendTo="@(body)" width="75%">
			
		<h:form id="frmMeritos">
		
			<p:dataTable var="merito" value="#{seleccionBean.meritos}"
				editable="true" >
				
				<p:column headerText="#{msg['bolsas.criterio.tipo']}" groupRow="true">
					<h:outputText value="#{merito.criterio.tipo.descripcion}" />
				</p:column>
			
				<p:column headerText="#{msg['bolsas.criterio.descripcion']}">
					<h:outputText value="#{merito.criterio.descripcio}" />
				</p:column>
				
				<p:column headerText="#{msg['bolsas.criterio.punts']}">
					<h:outputText value="#{merito.criterio.puntosPorUnidad}" />
				</p:column>
				
				<p:column headerText="#{msg['bolsas.criterio.maxima']}">
					<h:outputText value="#{merito.criterio.puntuacionMaxima}" />
				</p:column>
						
				<p:column headerText="#{msg['inscripcion.unidades']}">
					<p:cellEditor>
						<f:facet name="output"><h:outputText value="#{merito.unidades}" /></f:facet>
						<f:facet name="input"><h:inputText value="#{merito.unidades}" /></f:facet>
					</p:cellEditor>
				</p:column>
				
				<p:column>
					<p:rowEditor/>
				</p:column>
					
			</p:dataTable>
			
		</h:form>
      	
      	<br/>
      
      	<p:commandButton value="#{msg['inscripcion.meritos.guardar']}" action="#{seleccionBean.guardarMeritosToSeleccion}" 
      		oncomplete="PF('wvMerits').hide()" update=":frmLista"/>
      
	</p:dialog>
		



	<!-- DIALOG EXCLUSION -->
	<p:dialog header="#{msg['inscripcion.excluir.msg']}" showEffect="fade" modal="true" widgetVar="wvExclusion" appendTo="@(body)">
		<h:form id="frmExclusion">
                  
            <p:outputPanel id="manage-product-content" class="ui-fluid" rendered="#{seleccionBean.seleccion != null}">
            
            	<p:panelGrid columns="3" >
						<p:outputLabel value="#{msg['inscripcion.motivo']}"/>
						<p:selectOneMenu id="selMotivo" value="#{seleccionBean.seleccion.motiuExclusio}">
	                    	<f:selectItems value="#{seleccionBean.listaMotivosExclusion}" var="varMotivo" itemValue="#{varMotivo}" itemLabel="#{varMotivo}" />
		                </p:selectOneMenu>	
						<p:message for="selMotivo"/>
						
						<p:outputLabel value="" />
						<p:commandButton action="#{seleccionBean.excluirSeleccion}" value="#{msg['inscripcion.excluir']}" 
							update=":frmLista" oncomplete="PF('wvExclusion').hide()"/>
						<p:outputLabel value="" />
				</p:panelGrid>
				
			</p:outputPanel>
		</h:form>
	</p:dialog>		
		
		
		
		
	</ui:define>

</ui:composition>